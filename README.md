# 广小轻 Miniapp server

### 简述

现在市场是主流的校园小程序主要是有料同学,百度贴吧(校园吧)
,零点校园,叮点校园等等,但是他们都是存在着比较严重的问题,页面设计美观程度不够,广告泛滥,隐藏广告关闭按钮,功能上,比较少,如有料同学没有闲置商品,只是一个贴吧,并且贴吧内有大量的广告信息,部分不良色情信息等等,以上竞品均没有课表查询功能,没有学时学分查询功能,更没有学校官方公告信息展示,有的甚至非本校园信息,校园信息数据混乱合并等等

表 1-1 竞品比较表

|           | **小轻**(**本程序**) | **有料同学** | **百度贴吧** | **零点校园** | **叮点校园** |
|-----------|-----------------|----------|----------|----------|----------|
| **流畅度**   | P               | P        | P        | O        | O        |
| **广告**    | O               | P        | P        | P        | P        |
| **私有化部署** | P               | O        | O        | O        | O        |
| **信息安全**  | P               | P        | P        | O        | O        |
| **课表查询**  | P               | O        | O        | O        | O        |
| **闲置商品**  | P               | O        | O        | O        | O        |
| **官方公告**  | P               | O        | O        | O        | O        |
| **动态**    | P               | P        | P        | P        | P        |

### 演示:

**运行展示:**

[点击观看演示视频](https://nanfangshaonian.feishu.cn/file/VIGDbL68eo98dOxgroGcEjn4nHv?from=from_copylink)

<video src="https://nanfangshaonian.feishu.cn/file/VIGDbL68eo98dOxgroGcEjn4nHv?from=from_copylink" controls="controls" width="500px"></video>

### 项目亮点:

**安全性保障**：

- 数据库**权限控制**采用了多用户配置，细分权限，确保敏感数据仅限授权人员访问。
- 采用了**定期数据库备份**策略，通过 Shell 脚本实现，以应对意外数据丢失或损坏的情况。
- 支付密码采用了独立设置，并且使用了**Bcrypt 加密算法**，有效保障了用户支付信息的安全性。
- 微信支付限定支付时间，防止恶意操作,并且订单号采用随机生成，防止订单号重复引起数据插入异常。
- 使用**AOP切面**加入**ip地址黑名单**机制以及**访问频率限制**，防止恶意访问,爬虫访问。
- 采取**HTTPS**协议,配置SSL证书,信息加密传输,防止数据在传输过程中被窃取或篡改。
- 采用**数据隔离**技术，支持**私有化部署**，数据存储在学校机房内，数据安全更有保障。各校数据**互不连通**，有效防止数据泄露和安全风险。

**订单管理和防止恶意操作**：

- 通过微信支付的查询订单(**轮询机制**)和回调 API 实现支付成功的**回调**功能，确保订单支付状态的及时更新。
- 引入**定时任务**和**异步任务**机制，系统自动取消未付款订单，防止恶意拍下拒绝付款情况的发生。

**任务中心的接单和任务完成机制**：

- 采取了**双方确认机制**，即在双方确认送达后即完成任务，保障了任务完成的**准确性和可靠性**。
- 为了确保任务完成情况，程序支持拍照上传功能，发布者可通过图片确认任务完成情况。

**图片渲染速度和程序响应速度优化**：

- 使用 Redis 缓存**高读取低修改**的数据，如 Token 信息和热门文章，减少了数据库的读取压力。
- 采用了对象存储的**策略模式**，混合使用两种对象存储，并利用 CDN 加速高延迟的存储，提高了图片渲染速度。
- 在小程序前端实现了懒加载，将部分缓存保存在用户手机上，减少了服务器请求次数，提升了程序响应速度。

**课程表数据保存的优化**：

- 采用了 MongoDB 非关系型数据库来保存课程表数据，解决了 JSON 格式在 MySQL 中存储的耦合性和查询效率低的问题。
- MongoDB 的 JSON 存储格式使得数据读取更为便捷，可根据键值对进行灵活的查询，大大提高了课程表数据的管理和查询效率。
- 采取**MogoDB文档模型**是因为这个课程表**主要的业务是读取**
  ,还有就是这个课程信息与学生信息并非关系模型,是文档模型,因为有的学生课程时间不一致,考量了性能以及业务需求,最终选择了文档模型的存储方式

**部署运维**

- **多环境部署支持**: 项目支持在不同环境（local、prod、docker）下的部署，使得应用能够灵活适配各种场景和需求,如开发环境、测试环境和生产环境。

- **Docker镜像化**: 通过提供的Dockerfile，项目能够轻松地构建Docker镜像，实现应用的快速部署和迁移。这种容器化的部署方式有效地提高了部署的灵活性和效率。

- **降低运维成本和操作难度**: 使用Docker简化了部署流程，降低了运维成本和操作难度。这意味着运维人员可以更容易地管理和维护应用，减少了出错的可能性，提高了运维效率。

这些措施不仅**提升了系统的安全性和稳定性**，还**优化了用户体验**，提高了系统的性能和响应速度，为项目的成功运行和用户满意度提供了坚实保障。

## 设计

### 应用架构设计

![img_1.png](img_1.png)
上图为本程序的应用架构图,如图所示主要用到的技术框架：

1. 数据库的**重要数据均已进行加密**，比如支付密码使用的是安全级别较高的Bcrypt加密，同时配置了SSL证书，支持HTTPS，安全性得到了一定的保障；
2. 存储数据使用了主流的数据库，Mysql作为存储关系型较强的信息，Redis用于保存缓存信息。由于发布时间较新的动态信息、部分用户的登陆状态信息等此类信息需要频繁读取，小程序的前端使用懒加载，提高了一定的性能；
3. 为了图片的响应速度得到保障，使用了七牛云的对象存储以及CDN加速，同时使用了Minio对象存储；
3. 由于本项目是基于小程序的开发,为此使用了HttpClient调用微信的API进行业务需求的书写;
4. 该小程序配置了后台管理系统(Web端)，使用Nginx反向代理进行系统的部署，同时配置了SSL证书；
5. 该项目是前后端分离项目，前端使用了Ajax进行发送请求，后端接口文档使用Apifox，类似于Swagger产品；
6. 后端基于 SpringBoot进行项目的开发，使用基于 ORM 的框架Mybatis-Plus同时使用 JWT 作为身份认证，提高了安全性以及性能(
   JWT的好处是减少了服务器的压力，同时Token解密需要密钥)。

### 业务设计

![img.png](img.png)
![img_2.png](img_2.png)
特别说明:以下功能需在个人设置上进行学生认证(可以通过上传学生证或者输入学号以及密码进行验证)
，学校官方账号会分配一个专属的管理员账号,多个学校数据不共享。

如图所示 业务架构分为5个模块
程序的ULM用例图所示,小程序提供了一系列功能，为学生提供了便利和交流的平台：

1. **官方公告与动态专区**: 学校发布重要通知和公告，同时师生可以自由发布校内动态，实现信息传递与校园生活分享的双向互动，促进校园文化建设。

2. **二手闲置与任务中心**: 学生可以在平台上发布二手物品信息，实现资源再利用，同时可以发布校园活动、兼职等信息，促进勤工俭学，解决师生生活中的困难，形成校内资源共享的生态。

3. **课程表与学生认证**: 学生可以通过小程序方便地查看课表信息，而且通过学生证认证确保了二手闲置交易的安全性，增加了用户的信任度和安全感。

4. **余额与地址管理**: 小程序支持微信支付和收益提现，同时提供了余额详情查询功能，用户可以方便地管理自己的财务信息。地址管理功能也为用户提供了方便，节省了填写常用地址的时间。

5. **个人设置**: 用户可以自定义个人信息，包括昵称、头像等，还可以设置支付密码和进行学生认证，提升了用户体验和安全性。

### SQL设计:

![img_3.png](img_3.png)
上述是数据库的UML 类图,具体详细的信息请查看本目录的doc/sql文件夹里面的ER图和数据库脚本,推荐查看doc/设计与开发文档里面的产品文档,里面详细记载了从设计到开发的每一项步骤

### API设计:

**在线API文档** [点击查看](https://apifox.com/apidoc/shared-7a42976b-cc7d-4e4c-979f-b9fc95139fd3/api-109473737)

**离线查看**

- 本程序提供openapi文档文件,支持导入Postman,Apifox,Apipost等主流的调试工具
- 提供

## Getting Started